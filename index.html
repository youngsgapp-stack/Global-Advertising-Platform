<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mr.Young's Billionaire Homepage - Interactive World Map</title>
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" 
          content="default-src 'self'; 
                   script-src 'self' 'unsafe-inline' 'unsafe-eval' https://api.mapbox.com https://www.paypal.com https://www.gstatic.com https://cdn.jsdelivr.net https://apis.google.com; 
                   style-src 'self' 'unsafe-inline' https://api.mapbox.com; 
                   img-src 'self' data: https: blob:; 
                   font-src 'self' data:; 
                   worker-src 'self' blob:;
                   connect-src 'self' data: https://api.mapbox.com https://events.mapbox.com https://server.arcgisonline.com https://geo.datav.aliyun.com https://echarts.apache.org https://raw.githubusercontent.com https://media.githubusercontent.com https://raw.fastgit.org https://rawcdn.githack.com https://www.paypal.com https://*.firebaseio.com https://*.googleapis.com https://*.gstatic.com https://cdn.jsdelivr.net https://*.cloudfunctions.net https://asia-northeast3-worldad-8be07.cloudfunctions.net wss://*.firebaseio.com;
                   frame-src https://www.paypal.com https://*.firebaseapp.com https://*.googleapis.com;">
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <!-- X-Frame-Options는 HTTP 헤더로만 설정 가능하므로 meta 태그에서는 제거됨 -->
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🌍</text></svg>">
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="map-container">
        <canvas id="stars-canvas"></canvas>
        <div id="map"></div>
        
        <!-- 좌측 햄버거 메뉴 버튼 -->
        <button id="hamburger-menu-btn" class="hamburger-menu-btn">
            <span></span>
            <span></span>
            <span></span>
        </button>
        
        <!-- 좌측 사이드 메뉴 -->
        <div id="side-menu" class="side-menu hidden">
            <div class="side-menu-header">
                <h3>메뉴</h3>
                <button id="close-side-menu" class="close-btn">&times;</button>
            </div>
            <div class="side-menu-content">
                <div class="side-menu-section">
                    <h4>사용자</h4>
                    <button id="side-user-login-btn" class="side-menu-btn user-login-btn">로그인</button>
                    <button id="side-user-logout-btn" class="side-menu-btn user-logout-btn hidden">로그아웃</button>
                    <button id="side-my-page-btn" class="side-menu-btn my-page-btn hidden">내 활동</button>
                    <button id="side-wallet-btn" class="side-menu-btn wallet-link-btn hidden">포인트 지갑</button>
                    <div id="side-wallet-chip" class="side-wallet-chip hidden">잔액 0P</div>
                    <span id="side-user-email" class="side-user-email hidden"></span>
                </div>
                <div class="side-menu-section" id="side-admin-section" style="display: none;">
                    <h4>관리</h4>
                    <button id="side-admin-login-btn" class="side-menu-btn admin-login-btn">Admin 로그인</button>
                    <button id="side-admin-logout-btn" class="side-menu-btn admin-logout-btn hidden">Admin 로그아웃</button>
                </div>
                <div class="side-menu-section">
                    <h4>옥션 대시보드</h4>
                    <button id="side-auction-dashboard-btn" class="side-menu-btn auction-dashboard-btn">옥션 대시보드</button>
                </div>
                <div class="side-menu-section">
                    <h4>커뮤니티</h4>
                </div>
                <div class="side-menu-section" id="side-moderator-section" style="display: none;">
                    <h4>모더레이션</h4>
                    <button id="side-moderation-btn" class="side-menu-btn moderation-btn">모더레이션 패널</button>
                </div>
                <div class="side-menu-section">
                    <h4>도움말</h4>
                    <button id="side-help-btn" class="side-menu-btn help-btn">Help</button>
                </div>
            </div>
        </div>
        
        <!-- 상단 헤더 -->
        <div class="header">
            <div class="header-content">
                <h1>Mr.Young Map</h1>
                <p>Global Advertising Platform</p>
            </div>
            <div class="header-actions">
                <button id="market-stats-btn" class="market-stats-btn">통계</button>
                <button id="my-page-btn" class="my-page-btn hidden">내 활동</button>
                <button id="wallet-btn" class="wallet-btn hidden">
                    <span>포인트 지갑</span>
                    <span id="wallet-balance-chip" class="wallet-balance-chip">0P</span>
                </button>
                <button id="user-login-btn" class="user-login-btn">로그인</button>
                <button id="user-logout-btn" class="user-logout-btn hidden">로그아웃</button>
                <span id="user-email" class="user-email hidden"></span>
                <button id="help-btn" class="help-btn">Help</button>
                <button id="admin-login-btn" class="admin-login-btn">Admin</button>
                <button id="admin-logout-btn" class="admin-logout-btn hidden">Logout</button>
            </div>
        </div>
        
        <!-- 우측 정보 패널 -->
        <div id="info-panel" class="info-panel hidden">
            <div class="panel-header">
                <h3 id="region-name">지역 정보</h3>
                <button id="close-panel" class="close-btn">&times;</button>
            </div>
            <div class="panel-content">
                <div class="region-details">
                    <p><strong>국가:</strong> <span id="country-name">-</span></p>
                    <p><strong>행정구역:</strong> <span id="admin-level">-</span></p>
                    <p><strong>인구:</strong> <span id="population">-</span></p>
                    <p><strong>면적:</strong> <span id="area">-</span></p>
                </div>
                <div class="advertising-info">
                    <h4>광고 정보</h4>
                    <p><strong>상태:</strong> <span id="ad-status">사용 가능</span></p>
                    <p><strong>가격:</strong> <span id="ad-price">$0</span></p>
                    <button id="purchase-btn" class="purchase-btn">이 지역 구매하기</button>
                    <div id="paypal-buttons" style="margin-top: 15px;"></div>
                </div>
            </div>
        </div>
        
        
        <!-- 좌측 컨트롤 패널 (숨김) -->
        <div id="control-panel" class="control-panel hidden">
            <div class="panel-header">
                <h3>지도 제어</h3>
                <button id="close-menu" class="close-btn">&times;</button>
            </div>
            <div class="panel-content">
                <div class="zoom-controls">
                    <h4>줌 레벨</h4>
                    <button id="zoom-world">전 세계</button>
                    <button id="zoom-country">국가별</button>
                    <button id="zoom-region">지역별</button>
                </div>
                <div class="legend">
                    <h4>범례</h4>
                    <div class="legend-item">
                        <div class="legend-color available"></div>
                        <span>사용 가능</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color occupied"></div>
                        <span>광고 중</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color selected"></div>
                        <span>선택됨</span>
                    </div>
                </div>
                <div class="statistics">
                    <h4>통계</h4>
                    <div class="stat-item">
                        <span class="stat-label">총 지역:</span>
                        <span id="total-regions" class="stat-value">15</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">광고 중:</span>
                        <span id="occupied-regions" class="stat-value">3</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">총 수익:</span>
                        <span id="total-revenue" class="stat-value">$0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">점유율:</span>
                        <span id="occupancy-rate" class="stat-value">20%</span>
                    </div>
                </div>
                <div class="community-reward-card">
                    <h4>커뮤니티 상금 & 무료 픽셀</h4>
                    <div class="community-metrics">
                        <div class="metric-item">
                            <span class="metric-label">상금 풀</span>
                            <span id="community-reward-total" class="metric-value">$0.00</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">무료 픽셀 풀</span>
                            <span id="community-free-pixels" class="metric-value">0 px</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">기여 옥션 수</span>
                            <span id="community-auctions-count" class="metric-value">0회</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">최근 기여</span>
                            <span id="community-last-contribution" class="metric-value">아직 없음</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">최근 무료 픽셀 드랍</span>
                            <span id="community-last-drop" class="metric-value">아직 없음</span>
                        </div>
                    </div>
                    <button id="trigger-pixel-airdrop" class="airdrop-btn" disabled>적립 대기중</button>
                    <p class="airdrop-hint">
                        모든 옥션 낙찰 금액의 10%가 커뮤니티 상금으로 적립됩니다. 상금이 충분히 모이면
                        무료 픽셀 드랍으로 전체 이용자에게 배포됩니다.
                    </p>
                </div>
            </div>
        </div>
        
        <!-- 관리자 패널 -->
        <div id="admin-panel" class="admin-panel hidden">
            <div class="admin-header">
                <h3>관리자 패널</h3>
                <button id="close-admin" class="close-btn">&times;</button>
            </div>
            <div class="admin-content">
                <div class="logo-management">
                    <h4>로고 관리</h4>
                    <div class="usage-guide">
                        <p><strong>사용법:</strong></p>
                        <ol>
                            <li>지도에서 주를 클릭하여 선택</li>
                            <li>이미지 파일을 선택하고 업로드</li>
                            <li>크기, 투명도, 회전 조정</li>
                            <li>로고 저장 버튼으로 적용</li>
                        </ol>
                    </div>
                    <div class="current-logo">
                        <h5>현재 선택된 주: <span id="selected-state-name">-</span></h5>
                        <div class="logo-preview">
                            <img id="current-logo-img" src="" alt="현재 로고" style="display: none;">
                            <div id="no-logo" class="no-logo">로고 없음</div>
                        </div>
                    </div>
                    <div class="logo-upload">
                        <h5>로고 업로드</h5>
                        <input type="file" id="logo-file-input" accept="image/*">
                        <button id="upload-logo" class="upload-btn">로고 업로드</button>
                    </div>
                    <div class="logo-settings">
                        <h5>로고 설정</h5>
                        <div class="setting-item">
                            <label>크기:</label>
                            <input type="range" id="logo-size" min="20" max="100" value="50">
                            <span id="logo-size-value">50px</span>
                        </div>
                        <div class="setting-item">
                            <label>투명도:</label>
                            <input type="range" id="logo-opacity" min="0.1" max="1" step="0.1" value="0.8">
                            <span id="logo-opacity-value">80%</span>
                        </div>
                        <div class="setting-item">
                            <label>회전:</label>
                            <input type="range" id="logo-rotation" min="0" max="360" value="0">
                            <span id="logo-rotation-value">0°</span>
                        </div>
                    </div>
                    <div class="color-settings">
                        <h5>지역 색상 설정</h5>
                        <div class="setting-item">
                            <label>지역 색상:</label>
                            <input type="color" id="region-color" value="#4ecdc4">
                            <span id="region-color-value">#4ecdc4</span>
                        </div>
                        <div class="setting-item">
                            <label>경계선 색상:</label>
                            <input type="color" id="border-color" value="#ffffff">
                            <span id="border-color-value">#ffffff</span>
                        </div>
                        <div class="setting-item">
                            <label>경계선 두께:</label>
                            <input type="range" id="border-width" min="1" max="5" value="1">
                            <span id="border-width-value">1px</span>
                        </div>
                        <div class="preset-colors">
                            <h6>브랜드 색상 프리셋</h6>
                            <div class="color-presets">
                                <div class="color-preset" data-color="#ff6b6b" data-border="#d63031" title="빨간색 브랜드">
                                    <div class="preset-color" style="background: #ff6b6b; border: 2px solid #d63031;"></div>
                                </div>
                                <div class="color-preset" data-color="#4ecdc4" data-border="#00b894" title="청록색 브랜드">
                                    <div class="preset-color" style="background: #4ecdc4; border: 2px solid #00b894;"></div>
                                </div>
                                <div class="color-preset" data-color="#feca57" data-border="#fdcb6e" title="노란색 브랜드">
                                    <div class="preset-color" style="background: #feca57; border: 2px solid #fdcb6e;"></div>
                                </div>
                                <div class="color-preset" data-color="#a29bfe" data-border="#6c5ce7" title="보라색 브랜드">
                                    <div class="preset-color" style="background: #a29bfe; border: 2px solid #6c5ce7;"></div>
                                </div>
                                <div class="color-preset" data-color="#fd79a8" data-border="#e84393" title="핑크색 브랜드">
                                    <div class="preset-color" style="background: #fd79a8; border: 2px solid #e84393;"></div>
                                </div>
                                <div class="color-preset" data-color="#00b894" data-border="#00a085" title="초록색 브랜드">
                                    <div class="preset-color" style="background: #00b894; border: 2px solid #00a085;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="logo-actions">
                        <button id="save-logo" class="save-btn">로고 저장</button>
                        <button id="remove-logo" class="remove-btn">로고 제거</button>
                        <button id="reset-logo" class="reset-btn">설정 초기화</button>
                    </div>
                </div>
                
                <!-- 지역 정보 관리 -->
                <div class="region-management">
                    <h4>지역 정보 관리</h4>
                    <div class="region-form">
                        <div class="form-group">
                            <label>지역명 (한국어):</label>
                            <input type="text" id="region-name-ko-input" placeholder="한국어 지역명">
                        </div>
                        <div class="form-group">
                            <label>지역명 (영어):</label>
                            <input type="text" id="region-name-en-input" placeholder="영어 지역명">
                        </div>
                        <div class="form-group">
                            <label>국가:</label>
                            <input type="text" id="region-country-input" placeholder="국가명">
                        </div>
                        <div class="form-group">
                            <label>행정구역 레벨:</label>
                            <input type="text" id="region-admin-level-input" placeholder="예: State, Prefecture, City">
                        </div>
                        <div class="form-group">
                            <label>인구:</label>
                            <input type="number" id="region-population-input" placeholder="인구수">
                        </div>
                        <div class="form-group">
                            <label>면적 (km²):</label>
                            <input type="number" id="region-area-input" placeholder="면적">
                        </div>
                        <div class="form-group">
                            <label>광고 가격 (USD):</label>
                            <input type="number" id="region-ad-price-input" placeholder="광고 가격">
                        </div>
                        <div class="form-group">
                            <label>광고 상태:</label>
                            <select id="region-ad-status-input">
                                <option value="available">사용 가능</option>
                                <option value="occupied">광고 중</option>
                            </select>
                        </div>
                        <div class="region-actions">
                            <button id="save-region-info" class="save-btn">지역 정보 저장</button>
                        </div>
                        <div class="region-bulk-actions" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
                            <h5>일괄 작업</h5>
                            <button id="sync-all-regions-btn" class="save-btn" style="background: #2ecc71;">모든 지역 Firestore 동기화</button>
                            <p style="font-size: 12px; color: #666; margin-top: 10px;">
                                모든 지역의 광고 가격을 1000달러로 통일하고, 면적/인구수 데이터를 Firestore에 저장합니다.
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- 기업 정보 관리 -->
                <div class="company-management">
                    <h4>기업 정보 관리</h4>
                    <div class="company-form">
                        <div class="form-group">
                            <label>기업명:</label>
                            <input type="text" id="company-name-input" placeholder="기업명을 입력하세요">
                        </div>
                        <div class="form-group">
                            <label>산업:</label>
                            <input type="text" id="company-industry-input" placeholder="산업 분야">
                        </div>
                        <div class="form-group">
                            <label>설립년도:</label>
                            <input type="number" id="company-founded-input" placeholder="예: 2020">
                        </div>
                        <div class="form-group">
                            <label>직원 수:</label>
                            <input type="text" id="company-employees-input" placeholder="예: 100명">
                        </div>
                        <div class="form-group">
                            <label>웹사이트:</label>
                            <input type="url" id="company-website-input" placeholder="https://example.com">
                        </div>
                        <div class="form-group">
                            <label>기업 소개:</label>
                            <textarea id="company-description-input" placeholder="기업에 대한 간단한 소개를 입력하세요" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label>주요 특징 (줄바꿈으로 구분):</label>
                            <textarea id="company-features-input" placeholder="특징1&#10;특징2&#10;특징3" rows="3"></textarea>
                        </div>
                        <div class="company-actions">
                            <button id="save-company-info" class="save-btn">기업 정보 저장</button>
                            <button id="preview-company-info" class="preview-btn">미리보기</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 관리자 모드 해제 빠른 버튼 -->
        <button id="admin-exit-btn" class="admin-exit-btn hidden">관리자 모드 해제</button>
        
        <!-- 관리자 로그인 모달 -->
        <div id="admin-login-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>관리자 로그인</h2>
                    <button id="close-admin-login" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="login-form">
                        <div class="form-group">
                            <label for="admin-username">사용자명:</label>
                            <input type="text" id="admin-username" placeholder="관리자 ID">
                        </div>
                        <div class="form-group">
                            <label for="admin-password">비밀번호:</label>
                            <input type="password" id="admin-password" placeholder="비밀번호">
                        </div>
                        <button id="admin-login-submit" class="login-btn">로그인</button>
                        <div id="login-error" class="error-message hidden">잘못된 로그인 정보입니다.</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 사용자 로그인 모달 -->
        <div id="user-login-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>사용자 로그인</h2>
                    <button id="close-user-login" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="login-form">
                        <div class="form-group">
                            <label for="user-email-input">이메일:</label>
                            <input type="email" id="user-email-input" placeholder="이메일 주소">
                        </div>
                        <div class="form-group">
                            <label for="user-password-input">비밀번호:</label>
                            <input type="password" id="user-password-input" placeholder="비밀번호">
                        </div>
                        <button id="user-login-submit" class="login-btn">로그인</button>
                        <button id="user-google-signup-btn" class="google-signup-btn">
                            <svg width="18" height="18" viewBox="0 0 18 18" style="margin-right: 8px; vertical-align: middle;">
                                <path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z"/>
                                <path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.965-2.184l-2.908-2.258c-.806.54-1.837.86-3.057.86-2.35 0-4.34-1.587-5.055-3.72H.957v2.332C2.438 15.983 5.482 18 9 18z"/>
                                <path fill="#FBBC05" d="M3.945 10.698c-.18-.54-.282-1.117-.282-1.698s.102-1.158.282-1.698V4.97H.957C.348 6.175 0 7.55 0 9s.348 2.825.957 4.03l2.988-2.332z"/>
                                <path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.97L3.945 7.302C4.66 5.167 6.65 3.58 9 3.58z"/>
                            </svg>
                            구글로 회원가입하기
                        </button>
                        <div id="user-login-error" class="error-message hidden">로그인 정보를 확인하세요.</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 기업 정보 모달 (통합: 지역 + 기업 정보) -->
        <div id="company-info-modal" class="modal hidden">
            <div class="modal-content company-modal">
                <div class="modal-header">
                    <h2 id="company-name">지역 & 기업 정보</h2>
                    <button id="close-company-info" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <!-- 지역 정보 섹션 -->
                    <div class="region-info-section">
                        <h3 class="section-title">
                            <span class="label-primary">🗺️ 지역 정보</span>
                            <span class="label-secondary" id="company-region-section-label-en"></span>
                        </h3>
                        <div class="region-info-grid">
                            <div class="detail-card">
                                <div class="detail-icon">📍</div>
                                <div class="detail-content">
                                    <label>
                                        <span class="label-primary">지역명</span>
                                        <span class="label-secondary" id="company-region-label-en"></span>
                                    </label>
                                    <span id="company-region">-</span>
                                </div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-icon">👥</div>
                                <div class="detail-content">
                                    <label>
                                        <span class="label-primary">인구</span>
                                        <span class="label-secondary" id="company-region-population-label-en"></span>
                                    </label>
                                    <span id="company-region-population">-</span>
                                </div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-icon">📏</div>
                                <div class="detail-content">
                                    <label>
                                        <span class="label-primary">면적</span>
                                        <span class="label-secondary" id="company-region-area-label-en"></span>
                                    </label>
                                    <span id="company-region-area">-</span>
                                </div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-icon">🏛️</div>
                                <div class="detail-content">
                                    <label>
                                        <span class="label-primary">행정구역</span>
                                        <span class="label-secondary" id="company-region-admin-level-label-en"></span>
                                    </label>
                                    <span id="company-region-admin-level">-</span>
                                </div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-icon">💰</div>
                                <div class="detail-content">
                                    <label>
                                        <span class="label-primary">광고 가격</span>
                                        <span class="label-secondary" id="company-region-price-label-en"></span>
                                    </label>
                                    <span id="company-region-price">-</span>
                                </div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-icon">📊</div>
                                <div class="detail-content">
                                    <label>
                                        <span class="label-primary">상태</span>
                                        <span class="label-secondary" id="company-region-status-label-en"></span>
                                    </label>
                                    <span id="company-region-status">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 구분선 -->
                    <div class="divider"></div>
                    
                    <!-- 기업 정보 섹션 -->
                    <div class="company-info-section">
                        <h3 class="section-title">
                            <span class="label-primary">🏢 대표 기업 정보</span>
                            <span class="label-secondary" id="company-info-section-label-en"></span>
                        </h3>
                        <div class="company-header">
                            <div class="company-logo-section">
                                <img id="company-logo" src="" alt="기업 로고" class="company-logo-img">
                            </div>
                            <div class="company-basic-info">
                                <h4 id="company-name-title">기업명</h4>
                            </div>
                        </div>
                        
                        <div class="company-details-grid">
                            <div class="detail-card">
                                <div class="detail-icon">🏭</div>
                                <div class="detail-content">
                                    <label>
                                        <span class="label-primary">산업 분야</span>
                                        <span class="label-secondary" id="company-industry-label-en"></span>
                                    </label>
                                    <span id="company-industry">-</span>
                                </div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-icon">📅</div>
                                <div class="detail-content">
                                    <label>
                                        <span class="label-primary">설립년도</span>
                                        <span class="label-secondary" id="company-founded-label-en"></span>
                                    </label>
                                    <span id="company-founded">-</span>
                                </div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-icon">👥</div>
                                <div class="detail-content">
                                    <label>
                                        <span class="label-primary">직원 수</span>
                                        <span class="label-secondary" id="company-employees-label-en"></span>
                                    </label>
                                    <span id="company-employees">-</span>
                                </div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-icon">🌐</div>
                                <div class="detail-content">
                                    <label>
                                        <span class="label-primary">웹사이트</span>
                                        <span class="label-secondary" id="company-website-label-en"></span>
                                    </label>
                                    <a id="company-website" href="#" target="_blank">-</a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="company-description">
                            <h4>
                                <span class="label-primary">📋 기업 소개</span>
                                <span class="label-secondary" id="company-description-label-en"></span>
                            </h4>
                            <p id="company-description-text">-</p>
                        </div>
                        
                        <div class="company-features">
                            <h4>
                                <span class="label-primary">✨ 주요 특징</span>
                                <span class="label-secondary" id="company-features-label-en"></span>
                            </h4>
                            <ul id="company-features-list">
                                <li>-</li>
                            </ul>
                        </div>
                        
                        <!-- 관리자 모드에서만 표시되는 편집 버튼 -->
                        <div class="company-actions" id="company-modal-actions">
                            <button id="company-purchase-btn" class="purchase-btn">이 지역 구매하기</button>
                            <button id="company-edit-btn" class="edit-btn hidden">지역 정보 편집</button>
                            <button id="company-edit-pixel-btn" class="edit-pixel-btn hidden">픽셀 아트 편집</button>
                            <div id="company-paypal-buttons" style="margin-top: 15px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 지역 정보 모달 (광고가 없을 때) -->
        <div id="region-info-modal" class="modal hidden">
            <div class="modal-content region-modal">
                <div class="modal-header">
                    <h2>
                        <span class="label-primary" id="region-modal-title">지역 정보</span>
                        <span class="label-secondary" id="region-modal-title-en"></span>
                    </h2>
                    <button id="close-region-info" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="region-info">
                        <div class="region-header">
                            <div class="region-flag-section">
                                <div id="region-flag" class="region-flag">🏴</div>
                            </div>
                            <div class="region-basic-info">
                                <h3 id="region-modal-name">-</h3>
                                <p class="region-location">📍 <span id="region-modal-country">-</span></p>
                            </div>
                        </div>
                        
                        <div class="region-details-grid">
                            <div class="detail-card">
                                <div class="detail-icon">👥</div>
                                <div class="detail-content">
                                    <label>
                                        <span class="label-primary">인구</span>
                                        <span class="label-secondary" id="region-modal-population-label-en"></span>
                                    </label>
                                    <span id="region-modal-population">-</span>
                                </div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-icon">📏</div>
                                <div class="detail-content">
                                    <label>
                                        <span class="label-primary">면적</span>
                                        <span class="label-secondary" id="region-modal-area-label-en"></span>
                                    </label>
                                    <span id="region-modal-area">-</span>
                                </div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-icon">🏛️</div>
                                <div class="detail-content">
                                    <label>
                                        <span class="label-primary">행정구역</span>
                                        <span class="label-secondary" id="region-modal-admin-level-label-en"></span>
                                    </label>
                                    <span id="region-modal-admin-level">-</span>
                                </div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-icon">💰</div>
                                <div class="detail-content">
                                    <label>
                                        <span class="label-primary">광고 가격</span>
                                        <span class="label-secondary" id="region-modal-price-label-en"></span>
                                    </label>
                                    <span id="region-modal-price">-</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="region-status">
                            <h4>
                                <span class="label-primary">📊 광고 상태</span>
                                <span class="label-secondary" id="region-modal-status-label-en"></span>
                            </h4>
                            <div class="status-info">
                                <div class="status-badge" id="region-modal-status">
                                    <span class="status-icon">✅</span>
                                    <span class="status-text">Available</span>
                                </div>
                                <p class="status-description">
                                    <span class="description-primary">이 지역은 현재 광고를 등록할 수 있습니다.</span>
                                    <span class="description-secondary" id="region-modal-status-description-en"></span>
                                </p>
                            </div>
                        </div>
                        
                        <!-- 옥션 정보 섹션 (옥션이 있을 때만 표시) -->
                        <div id="region-auction-section" class="region-auction-section hidden">
                            <h4>
                                <span class="label-primary">🔨 옥션 정보</span>
                                <span class="label-secondary">Auction Information</span>
                            </h4>
                            <div class="auction-info-grid">
                                <div class="detail-card">
                                    <div class="detail-icon">💰</div>
                                    <div class="detail-content">
                                        <label>
                                            <span class="label-primary">현재 입찰가</span>
                                            <span class="label-secondary">Current Bid</span>
                                        </label>
                                        <span id="region-auction-current-bid">-</span>
                                    </div>
                                </div>
                                <div class="detail-card">
                                    <div class="detail-icon">⏰</div>
                                    <div class="detail-content">
                                        <label>
                                            <span class="label-primary">남은 시간</span>
                                            <span class="label-secondary">Time Remaining</span>
                                        </label>
                                        <span id="region-auction-time-remaining">-</span>
                                    </div>
                                </div>
                                <div class="detail-card">
                                    <div class="detail-icon">👤</div>
                                    <div class="detail-content">
                                        <label>
                                            <span class="label-primary">최고 입찰자</span>
                                            <span class="label-secondary">Highest Bidder</span>
                                        </label>
                                        <span id="region-auction-highest-bidder">-</span>
                                    </div>
                                </div>
                                <div class="detail-card">
                                    <div class="detail-icon">📈</div>
                                    <div class="detail-content">
                                        <label>
                                            <span class="label-primary">예상 노출 수</span>
                                            <span class="label-secondary">Estimated Impressions</span>
                                        </label>
                                        <span id="region-estimated-impressions">-</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 홀더 프로필 -->
                            <div id="region-holder-profile" class="holder-profile hidden">
                                <h4>
                                    <span class="label-primary">👑 현재 소유자</span>
                                    <span class="label-secondary">Current Owner</span>
                                </h4>
                                <div class="holder-info">
                                    <div class="holder-avatar">👤</div>
                                    <div class="holder-details">
                                        <div class="holder-name" id="region-holder-name">-</div>
                                        <div class="holder-email" id="region-holder-email">-</div>
                                        <div class="holder-stats">
                                            <span class="holder-stat">소유 지역: <span id="region-holder-regions-count">0</span>개</span>
                                            <span class="holder-stat">총 입찰: <span id="region-holder-total-bids">0</span>회</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 입찰 타임라인 -->
                            <div id="region-bid-timeline" class="bid-timeline">
                                <h4>
                                    <span class="label-primary">📅 입찰 이력</span>
                                    <span class="label-secondary">Bid History</span>
                                </h4>
                                <div id="region-bid-timeline-list" class="timeline-list">
                                    <p style="text-align: center; color: #666; padding: 20px;">입찰 이력이 없습니다.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="region-actions">
                            <button id="region-purchase-btn" class="purchase-btn">이 지역 구매하기</button>
                            <button id="region-edit-btn" class="edit-btn hidden">지역 정보 편집</button>
                            <button id="region-edit-pixel-btn" class="edit-pixel-btn hidden">픽셀 아트 편집</button>
                            <div id="region-paypal-buttons" style="margin-top: 15px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 옥션 모달 -->
        <div id="auction-modal" class="modal hidden">
            <div class="modal-content auction-modal">
                <div class="modal-header">
                    <h2>
                        <span class="label-primary">옥션 참여</span>
                        <span class="label-secondary">Auction</span>
                    </h2>
                    <button id="close-auction-modal" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="auction-info">
                        <div class="auction-header">
                            <h3 id="auction-region-name">-</h3>
                            <p class="auction-location">📍 <span id="auction-country">-</span></p>
                        </div>
                        
                        <div class="auction-status">
                            <div class="auction-timer">
                                <h4>남은 시간</h4>
                                <div id="auction-countdown" class="countdown">00:00:00</div>
                            </div>
                            <div class="auction-current-bid">
                                <h4>현재 입찰가</h4>
                                <div id="auction-current-bid" class="current-bid-amount">$1.00</div>
                            </div>
                        </div>
                        
                        <div class="auction-rules">
                            <h4>옥션 규칙</h4>
                            <ul>
                                <li>초기가: $1.00</li>
                                <li>최소 입찰 증가액: $0.10</li>
                                <li>옥션 기간: 최소 12시간 보장</li>
                                <li>마지막 2분 내 입찰 시 자동 2분 연장 (anti-sniping)</li>
                            </ul>
                        </div>
                        
                        <div class="auction-bid-section" id="auction-bid-section">
                            <h4>입찰하기</h4>
                            <div class="bid-input-group">
                                <label>입찰 금액 (USD)</label>
                                <input type="number" id="bid-amount-input" min="1" step="0.1" value="1.0">
                                <button id="place-bid-btn" class="bid-btn">입찰하기</button>
                            </div>
                            <p class="bid-hint">최소 입찰가: <span id="min-bid-amount">$1.10</span></p>
                            <div class="auction-wallet-status">
                                <div class="wallet-inline">
                                    <span class="wallet-inline-label">사용 가능 포인트</span>
                                    <strong id="auction-wallet-available">0P</strong>
                                    <button id="auction-open-wallet" class="wallet-inline-btn">지갑 열기</button>
                                </div>
                                <p id="auction-wallet-warning" class="wallet-inline-warning hidden">
                                    잔액이 부족합니다. 포인트를 충전한 뒤 다시 시도해주세요.
                                </p>
                            </div>
                        </div>

                        <div class="auction-status-panel hidden" id="auction-status-panel">
                            <div class="auction-status-chip status-live" id="auction-status-chip">입찰 대기</div>
                            <p class="auction-status-message" id="auction-status-message">현재 옥션 상태를 불러오는 중입니다.</p>
                            <p class="auction-status-subtext hidden" id="auction-status-subtext"></p>
                            <button id="auction-pay-now-btn" class="auction-cta-btn hidden">지금 결제하기</button>
                        </div>
                        
                        <div class="auction-bid-history">
                            <h4>입찰 이력</h4>
                            <div id="auction-bid-history" class="bid-history-list">
                                <p>아직 입찰이 없습니다.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 픽셀 아트 스튜디오 사이드바 -->
        <div id="pixel-studio-modal" class="pixel-studio-sidebar hidden">
            <div class="pixel-studio-sidebar-content">
                <div class="modal-header">
                    <h2>
                        <span class="label-primary">픽셀 아트 스튜디오</span>
                        <span class="label-secondary">Pixel Art Studio</span>
                    </h2>
                    <button id="close-pixel-studio" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="pixel-studio-info">
                        <div class="pixel-studio-header">
                            <h3 id="pixel-studio-region-name">-</h3>
                            <p class="pixel-studio-location">📍 <span id="pixel-studio-country">-</span></p>
                            <div id="pixel-studio-permission-status" class="permission-status">
                                <span class="status-icon">🔒</span>
                                <span class="status-text">소유자 전용</span>
                            </div>
                        </div>
                        
                        <div class="pixel-studio-controls">
                            <!-- 간소화된 색상 선택 (가장 중요) -->
                            <div class="pixel-control-section">
                                <h4>🎨 색상 선택</h4>
                                <div class="color-picker-wrapper">
                                    <div class="color-picker-main">
                                        <input type="color" id="pixel-color-picker" value="#FF0000" style="width: 100%; height: 50px; cursor: pointer; border-radius: 8px; border: 2px solid rgba(78, 205, 196, 0.5);">
                                        <div class="current-color-display" style="margin-top: 10px; display: flex; align-items: center; gap: 10px;">
                                            <div class="color-preview" id="color-preview" style="background: #FF0000; width: 40px; height: 40px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.3);"></div>
                                            <input type="text" id="color-hex-input" value="#FF0000" placeholder="#FF0000" maxlength="7" style="flex: 1; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; color: #fff; font-family: monospace;">
                                        </div>
                                    </div>
                                    
                                    <!-- 기본 색상 (항상 표시) -->
                                    <div class="color-section" style="margin-top: 16px;">
                                        <label class="color-section-label">기본 색상</label>
                                        <div class="color-presets" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
                                            <div class="color-preset" data-color="#FF0000" style="background: #FF0000; aspect-ratio: 1; border-radius: 6px; cursor: pointer; transition: transform 0.2s;" title="빨강">R</div>
                                            <div class="color-preset" data-color="#00FF00" style="background: #00FF00; aspect-ratio: 1; border-radius: 6px; cursor: pointer; transition: transform 0.2s;" title="초록">G</div>
                                            <div class="color-preset" data-color="#0000FF" style="background: #0000FF; aspect-ratio: 1; border-radius: 6px; cursor: pointer; transition: transform 0.2s;" title="파랑">B</div>
                                            <div class="color-preset" data-color="#FFFF00" style="background: #FFFF00; aspect-ratio: 1; border-radius: 6px; cursor: pointer; transition: transform 0.2s;" title="노랑">Y</div>
                                            <div class="color-preset" data-color="#FF00FF" style="background: #FF00FF; aspect-ratio: 1; border-radius: 6px; cursor: pointer; transition: transform 0.2s;" title="마젠타">M</div>
                                            <div class="color-preset" data-color="#00FFFF" style="background: #00FFFF; aspect-ratio: 1; border-radius: 6px; cursor: pointer; transition: transform 0.2s;" title="시안">C</div>
                                            <div class="color-preset" data-color="#FFFFFF" style="background: #FFFFFF; border: 2px solid #ccc; aspect-ratio: 1; border-radius: 6px; cursor: pointer; transition: transform 0.2s;" title="흰색">W</div>
                                            <div class="color-preset" data-color="#000000" style="background: #000000; aspect-ratio: 1; border-radius: 6px; cursor: pointer; transition: transform 0.2s;" title="검정">K</div>
                                        </div>
                                    </div>
                                    
                                    <!-- 최근 사용한 색상 (간단하게) -->
                                    <div class="color-section" style="margin-top: 12px;">
                                        <label class="color-section-label">최근 사용</label>
                                        <div id="recent-colors" class="color-presets recent-colors" style="display: flex; gap: 6px; flex-wrap: wrap;">
                                            <div class="color-preset empty-slot" title="최근 사용한 색상이 없습니다" style="width: 32px; height: 32px; border: 2px dashed rgba(255,255,255,0.3); border-radius: 6px; display: flex; align-items: center; justify-content: center; color: rgba(255,255,255,0.5);">+</div>
                                        </div>
                                    </div>
                                    
                                    <!-- 추가 색상 팔레트 (접기 가능) -->
                                    <div class="pixel-control-section collapsible collapsed" style="margin-top: 12px; padding: 12px;">
                                        <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;">
                                            <h4 style="margin: 0; font-size: 0.9rem; color: rgba(255,255,255,0.7);">더 많은 색상</h4>
                                            <button class="collapse-toggle" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 0.8rem; cursor: pointer;">▼</button>
                                        </div>
                                        <div class="section-content" style="display: none; margin-top: 12px;">
                                            <!-- 파스텔 색상 -->
                                            <div class="color-section">
                                                <label class="color-section-label">파스텔</label>
                                                <div class="color-presets" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px;">
                                                    <div class="color-preset" data-color="#FFB6C1" style="background: #FFB6C1; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="연한 핑크"></div>
                                                    <div class="color-preset" data-color="#FFD700" style="background: #FFD700; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="골드"></div>
                                                    <div class="color-preset" data-color="#98FB98" style="background: #98FB98; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="연한 초록"></div>
                                                    <div class="color-preset" data-color="#87CEEB" style="background: #87CEEB; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="하늘색"></div>
                                                    <div class="color-preset" data-color="#DDA0DD" style="background: #DDA0DD; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="연한 보라"></div>
                                                    <div class="color-preset" data-color="#F0E68C" style="background: #F0E68C; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="카키"></div>
                                                    <div class="color-preset" data-color="#FFA07A" style="background: #FFA07A; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="연어색"></div>
                                                    <div class="color-preset" data-color="#20B2AA" style="background: #20B2AA; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="라이트 시안"></div>
                                                </div>
                                            </div>
                                            
                                            <!-- 다크 색상 -->
                                            <div class="color-section" style="margin-top: 12px;">
                                                <label class="color-section-label">다크</label>
                                                <div class="color-presets" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px;">
                                                    <div class="color-preset" data-color="#8B0000" style="background: #8B0000; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="다크 레드"></div>
                                                    <div class="color-preset" data-color="#006400" style="background: #006400; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="다크 그린"></div>
                                                    <div class="color-preset" data-color="#00008B" style="background: #00008B; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="다크 블루"></div>
                                                    <div class="color-preset" data-color="#4B0082" style="background: #4B0082; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="인디고"></div>
                                                    <div class="color-preset" data-color="#800080" style="background: #800080; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="퍼플"></div>
                                                    <div class="color-preset" data-color="#8B4513" style="background: #8B4513; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="브라운"></div>
                                                    <div class="color-preset" data-color="#2F4F4F" style="background: #2F4F4F; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="다크 슬레이트"></div>
                                                    <div class="color-preset" data-color="#696969" style="background: #696969; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="딤 그레이"></div>
                                                </div>
                                            </div>
                                            
                                            <!-- 브라이트 색상 -->
                                            <div class="color-section" style="margin-top: 12px;">
                                                <label class="color-section-label">브라이트</label>
                                                <div class="color-presets" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px;">
                                                    <div class="color-preset" data-color="#FF1493" style="background: #FF1493; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="딥 핑크"></div>
                                                    <div class="color-preset" data-color="#00FF7F" style="background: #00FF7F; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="스프링 그린"></div>
                                                    <div class="color-preset" data-color="#00CED1" style="background: #00CED1; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="다크 터키스"></div>
                                                    <div class="color-preset" data-color="#FF4500" style="background: #FF4500; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="오렌지 레드"></div>
                                                    <div class="color-preset" data-color="#9370DB" style="background: #9370DB; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="미디엄 퍼플"></div>
                                                    <div class="color-preset" data-color="#FF69B4" style="background: #FF69B4; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="핫 핑크"></div>
                                                    <div class="color-preset" data-color="#32CD32" style="background: #32CD32; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="라임 그린"></div>
                                                    <div class="color-preset" data-color="#1E90FF" style="background: #1E90FF; aspect-ratio: 1; border-radius: 4px; cursor: pointer;" title="도저 블루"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 간소화된 도구 섹션 (접기 가능) -->
                            <div class="pixel-control-section collapsible collapsed" style="padding: 12px;">
                                <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;">
                                    <h4 style="margin: 0; font-size: 0.9rem; color: rgba(255,255,255,0.7);">🛠️ 도구</h4>
                                    <button class="collapse-toggle" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 0.8rem; cursor: pointer;">▼</button>
                                </div>
                                <div class="section-content" style="display: none; margin-top: 12px;">
                                    <div class="tool-buttons" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                                        <button id="pixel-tool-pencil" class="tool-btn active" data-tool="pencil" title="연필 (P)" style="padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: #fff; cursor: pointer;">
                                            <span class="tool-icon">✏️</span>
                                            <span class="tool-label">연필</span>
                                        </button>
                                        <button id="pixel-tool-eraser" class="tool-btn" data-tool="eraser" title="지우개 (E)" style="padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: #fff; cursor: pointer;">
                                            <span class="tool-icon">🧹</span>
                                            <span class="tool-label">지우개</span>
                                        </button>
                                        <button id="pixel-tool-fill" class="tool-btn" data-tool="fill" title="채우기 (F)" style="padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: #fff; cursor: pointer;">
                                            <span class="tool-icon">🪣</span>
                                            <span class="tool-label">채우기</span>
                                        </button>
                                        <button id="pixel-tool-sticker" class="tool-btn" data-tool="sticker" title="스티커 (S)" style="padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: #fff; cursor: pointer;">
                                            <span class="tool-icon">🌟</span>
                                            <span class="tool-label">스티커</span>
                                        </button>
                                    </div>
                                    <div class="tool-actions" style="margin-top: 12px; display: flex; gap: 8px;">
                                        <button id="pixel-undo-btn" class="tool-action-btn" title="실행 취소 (Ctrl+Z)" style="flex: 1; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: #fff; cursor: pointer;">
                                            <span>↶</span> 실행 취소
                                        </button>
                                        <button id="pixel-redo-btn" class="tool-action-btn" title="다시 실행 (Ctrl+Y)" style="flex: 1; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: #fff; cursor: pointer;">
                                            <span>↷</span> 다시 실행
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 고급 기능 (모두 접기) -->
                            <div class="pixel-control-section collapsible collapsed" style="padding: 12px;">
                                <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;">
                                    <h4 style="margin: 0; font-size: 0.9rem; color: rgba(255,255,255,0.7);">⚙️ 고급 기능</h4>
                                    <button class="collapse-toggle" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 0.8rem; cursor: pointer;">▼</button>
                                </div>
                                <div class="section-content" style="display: none; margin-top: 12px;">
                                    <div class="action-buttons" style="display: flex; flex-direction: column; gap: 8px;">
                                        <button id="pixel-clear-btn" class="action-btn" style="padding: 10px; background: rgba(255,107,107,0.2); border: 1px solid rgba(255,107,107,0.4); border-radius: 6px; color: #ff6b6b; cursor: pointer;">전체 지우기</button>
                                        <button id="pixel-reset-btn" class="action-btn" style="padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: #fff; cursor: pointer;">초기화</button>
                                    </div>
                                    
                                    <div style="margin-top: 16px;">
                                        <h5 style="font-size: 0.85rem; color: rgba(255,255,255,0.7); margin-bottom: 8px;">템플릿</h5>
                                        <div id="pixel-template-list" class="template-list empty-state" style="padding: 12px; background: rgba(255,255,255,0.05); border-radius: 6px; text-align: center; color: rgba(255,255,255,0.5); font-size: 0.85rem;">
                                            <p style="margin: 0;">템플릿을 불러오는 중...</p>
                                        </div>
                                    </div>
                                    
                                    <div style="margin-top: 16px;">
                                        <h5 style="font-size: 0.85rem; color: rgba(255,255,255,0.7); margin-bottom: 8px;">스티커</h5>
                                        <div id="pixel-sticker-list" class="sticker-list empty-state" style="padding: 12px; background: rgba(255,255,255,0.05); border-radius: 6px; text-align: center; color: rgba(255,255,255,0.5); font-size: 0.85rem;">
                                            <p style="margin: 0;">스티커를 불러오는 중...</p>
                                        </div>
                                    </div>
                                    
                                    <div style="margin-top: 16px;">
                                        <h5 style="font-size: 0.85rem; color: rgba(255,255,255,0.7); margin-bottom: 8px;">브랜딩 가이드</h5>
                                        <select id="pixel-brand-guide-select" class="brand-guide-select" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: #fff; font-size: 0.85rem;">
                                            <option>로딩 중...</option>
                                        </select>
                                        <div id="pixel-brand-swatches" class="brand-swatches empty-state" style="margin-top: 8px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 6px; text-align: center; color: rgba(255,255,255,0.5); font-size: 0.85rem;">
                                            <p style="margin: 0;">추천 색상을 불러오는 중...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 캔버스는 Wplace 스타일에서는 지도에서 직접 편집하므로 숨김 -->
                        <div class="pixel-canvas-wrapper" style="display: none;">
                            <canvas id="pixel-canvas"></canvas>
                        </div>
                        
                        <div class="pixel-studio-actions">
                            <button id="pixel-save-btn" class="save-btn">저장</button>
                            <button id="pixel-load-btn" class="load-btn">불러오기</button>
                            <button id="pixel-history-btn" class="history-btn">버전 히스토리</button>
                            <button id="pixel-report-btn" class="report-btn">신고하기</button>
                            <button id="pixel-close-btn" class="close-studio-btn">닫기</button>
                        </div>
                        
                        <!-- 버전 히스토리 섹션 -->
                        <div id="pixel-version-history-section" class="pixel-version-history hidden">
                            <div class="version-history-header">
                                <h4>버전 히스토리</h4>
                                <button id="pixel-version-history-close" class="close-btn-small">×</button>
                            </div>
                            <div id="pixel-version-list" class="version-list">
                                <p style="text-align: center; color: #666; padding: 20px;">로딩 중...</p>
                            </div>
                        </div>
                        
                        <div id="pixel-studio-message" class="pixel-message hidden"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 픽셀 그리드 컨트롤 패널 -->
        <div id="pixel-grid-controls" class="pixel-grid-controls hidden">
            <h4 style="margin: 0 0 8px 0; font-size: 14px;">픽셀 편집</h4>
            <button id="toggle-grid-lines-btn" class="toggle-btn">그리드 선 표시</button>
            <div style="margin-top: 8px;">
                <label style="font-size: 12px; display: block; margin-bottom: 4px;">현재 색상:</label>
                <input type="color" id="current-pixel-color" value="#FF0000" style="width: 100%; height: 40px; cursor: pointer;">
            </div>
        </div>
        
        <!-- 단축키 가이드 모달 -->
        <div id="pixel-shortcuts-modal" class="modal hidden">
            <div class="modal-content shortcuts-modal">
                <div class="modal-header">
                    <h2>⌨️ 키보드 단축키</h2>
                    <button id="close-shortcuts-modal" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="shortcuts-grid">
                        <div class="shortcut-category">
                            <h3>도구</h3>
                            <div class="shortcut-item">
                                <kbd>P</kbd>
                                <span>연필 도구</span>
                            </div>
                            <div class="shortcut-item">
                                <kbd>E</kbd>
                                <span>지우개 도구</span>
                            </div>
                            <div class="shortcut-item">
                                <kbd>F</kbd>
                                <span>채우기 도구</span>
                            </div>
                            <div class="shortcut-item">
                                <kbd>S</kbd>
                                <span>스티커 도구</span>
                            </div>
                        </div>
                        <div class="shortcut-category">
                            <h3>편집</h3>
                            <div class="shortcut-item">
                                <kbd>Ctrl</kbd> + <kbd>Z</kbd>
                                <span>실행 취소</span>
                            </div>
                            <div class="shortcut-item">
                                <kbd>Ctrl</kbd> + <kbd>Y</kbd>
                                <span>다시 실행</span>
                            </div>
                            <div class="shortcut-item">
                                <kbd>Ctrl</kbd> + <kbd>S</kbd>
                                <span>저장</span>
                            </div>
                            <div class="shortcut-item">
                                <kbd>Delete</kbd>
                                <span>전체 지우기</span>
                            </div>
                        </div>
                        <div class="shortcut-category">
                            <h3>색상</h3>
                            <div class="shortcut-item">
                                <kbd>1-8</kbd>
                                <span>기본 색상 선택</span>
                            </div>
                            <div class="shortcut-item">
                                <kbd>C</kbd>
                                <span>색상 피커 열기</span>
                            </div>
                        </div>
                        <div class="shortcut-category">
                            <h3>기타</h3>
                            <div class="shortcut-item">
                                <kbd>?</kbd>
                                <span>단축키 가이드</span>
                            </div>
                            <div class="shortcut-item">
                                <kbd>Esc</kbd>
                                <span>모달 닫기</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 옥션 대시보드 모달 -->
        <div id="auction-dashboard-modal" class="modal hidden">
            <div class="modal-content auction-dashboard-modal">
                <div class="modal-header">
                    <h2>
                        <span class="label-primary">옥션 대시보드</span>
                        <span class="label-secondary">Auction Dashboard</span>
                    </h2>
                    <button id="close-auction-dashboard" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="dashboard-tabs">
                        <button class="tab-btn active" data-tab="active">진행 중</button>
                        <button class="tab-btn" data-tab="upcoming">예정</button>
                        <button class="tab-btn" data-tab="ended">종료</button>
                        <button class="tab-btn" data-tab="watching">관심 등록</button>
                    </div>
                    
                    <div class="dashboard-filters">
                        <select id="dashboard-country-filter">
                            <option value="all">모든 국가</option>
                        </select>
                        <input type="text" id="dashboard-search" placeholder="지역명 검색...">
                    </div>
                    
                    <div id="dashboard-auction-list" class="auction-list">
                        <p style="text-align: center; color: #666; padding: 20px;">로딩 중...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 사용자 대시보드 모달 -->
        <div id="user-dashboard-modal" class="modal hidden">
            <div class="modal-content user-dashboard-modal">
                <div class="modal-header">
                    <div>
                        <h2>
                            <span class="label-primary">내 활동</span>
                            <span class="label-secondary">My Page</span>
                        </h2>
                        <p class="modal-subtitle">참여 중인 옥션과 결과를 한눈에 확인하세요.</p>
                    </div>
                    <div class="modal-actions">
                        <button id="refresh-user-dashboard" class="refresh-btn" title="새로고침">새로고침</button>
                        <button id="close-user-dashboard" class="close-btn">&times;</button>
                    </div>
                </div>
                <div class="modal-body user-dashboard-body">
                    <div id="user-dashboard-loading" class="user-dashboard-loading">
                        <div class="loading-spinner"></div>
                        <p>데이터를 불러오는 중입니다...</p>
                    </div>
                    <div id="user-dashboard-error" class="user-dashboard-error hidden">
                        <p>데이터를 불러오지 못했습니다. 잠시 후 다시 시도해주세요.</p>
                        <button id="user-dashboard-retry-btn" class="retry-btn">다시 시도</button>
                    </div>
                    <div id="user-dashboard-content" class="user-dashboard-content hidden">
                        <div class="user-dashboard-summary">
                            <div class="summary-card">
                                <span class="summary-label">진행 중</span>
                                <span id="user-bids-active-count" class="summary-value">0</span>
                                <span class="summary-helper">Active Bids</span>
                            </div>
                            <div class="summary-card">
                                <span class="summary-label">낙찰</span>
                                <span id="user-bids-won-count" class="summary-value">0</span>
                                <span class="summary-helper">Won</span>
                            </div>
                            <div class="summary-card">
                                <span class="summary-label">유찰/종료</span>
                                <span id="user-bids-lost-count" class="summary-value">0</span>
                                <span class="summary-helper">Lost</span>
                            </div>
                            <div class="summary-card">
                                <span class="summary-label">총 입찰액</span>
                                <span id="user-bids-total-amount" class="summary-value">$0.00</span>
                                <span class="summary-helper">Total Bid Value</span>
                            </div>
                        </div>
                        <div class="user-dashboard-tabs">
                            <button class="tab-btn active" data-tab="active">진행 중</button>
                            <button class="tab-btn" data-tab="won">낙찰</button>
                            <button class="tab-btn" data-tab="lost">유찰/종료</button>
                        </div>
                        <div id="user-dashboard-empty" class="user-dashboard-empty hidden">
                            <p>아직 참여한 옥션이 없습니다. 관심 지역에 입찰해보세요!</p>
                        </div>
                        <div id="user-dashboard-list" class="user-dashboard-list"></div>
                        <div class="user-dashboard-timeline">
                            <div class="timeline-header">
                                <h3>최근 활동</h3>
                            </div>
                            <div id="user-dashboard-activity" class="user-dashboard-activity"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 포인트 지갑 모달 -->
        <div id="wallet-modal" class="modal hidden">
            <div class="modal-content wallet-modal">
                <div class="modal-header">
                    <div>
                        <h2>
                            <span class="label-primary">포인트 지갑</span>
                            <span class="label-secondary">Wallet</span>
                        </h2>
                        <p class="modal-subtitle">입찰 포인트 잔액과 홀드 현황을 실시간으로 확인하세요.</p>
                    </div>
                    <div class="modal-actions">
                        <button id="wallet-refresh-btn" class="wallet-secondary-btn">새로고침</button>
                        <button id="close-wallet-modal" class="close-btn">&times;</button>
                    </div>
                </div>
                <div class="modal-body wallet-modal-body">
                    <div class="wallet-summary-grid">
                        <div class="wallet-card accent">
                            <span class="wallet-card-label">총 잔액</span>
                            <strong id="wallet-balance-value">0P</strong>
                            <small>충전된 전체 포인트</small>
                        </div>
                        <div class="wallet-card">
                            <span class="wallet-card-label">홀드 중</span>
                            <strong id="wallet-hold-value">0P</strong>
                            <small>최고 입찰 유지 금액</small>
                        </div>
                        <div class="wallet-card">
                            <span class="wallet-card-label">사용 가능</span>
                            <strong id="wallet-available-value">0P</strong>
                            <small>즉시 입찰 가능한 포인트</small>
                        </div>
                    </div>
                    <div class="wallet-actions-row">
                        <button id="wallet-topup-btn" class="wallet-primary-btn">포인트 충전</button>
                        <div id="wallet-paypal-buttons" style="margin-top: 15px;"></div>
                        <span id="wallet-error-inline" class="wallet-error-message hidden"></span>
                    </div>
                    <div class="wallet-history">
                        <div class="wallet-history-header">
                            <h4>최근 활동</h4>
                            <span id="wallet-last-updated" class="wallet-last-updated">-</span>
                        </div>
                        <div id="wallet-history-list" class="wallet-history-list">
                            <p class="wallet-empty">거래 내역이 없습니다.</p>
                        </div>
                    </div>
                    <div class="wallet-helper">
                        <p>
                            최고 입찰자가 되면 해당 금액이 자동으로 홀드되며, 다른 사용자가 추월하거나 옥션이 종료되면 즉시 해제됩니다.
                            포인트 충전은 PayPal을 통해 안전하게 처리됩니다. (1 USD = 100P)
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 통계 & 수익 모델 모달 -->
        <div id="market-stats-modal" class="modal hidden">
            <div class="modal-content market-stats-modal">
                <div class="modal-header">
                    <h2>
                        <span class="label-primary">시장 통계 & 수익 모델</span>
                        <span class="label-secondary">Market Statistics & Revenue</span>
                    </h2>
                    <button id="close-market-stats" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="stats-tabs">
                        <button class="tab-btn active" data-tab="pricing">수익 모델</button>
                        <button class="tab-btn" data-tab="statistics">통계</button>
                        <button class="tab-btn" data-tab="fees">수수료 정책</button>
                    </div>
                    
                    <div id="pricing-tab" class="tab-content active">
                        <div class="pricing-plans">
                            <div class="pricing-card">
                                <h3>단기 임대</h3>
                                <div class="price">$1.00</div>
                                <p class="duration">12시간</p>
                                <ul>
                                    <li>옥션 기반 경매</li>
                                    <li>최소 12시간 보장</li>
                                    <li>마지막 5분 연장 가능</li>
                                </ul>
                                <button class="plan-btn">선택</button>
                            </div>
                            <div class="pricing-card featured">
                                <h3>장기 점유</h3>
                                <div class="price">$50.00</div>
                                <p class="duration">7일</p>
                                <ul>
                                    <li>7일간 소유권 보장</li>
                                    <li>자동 갱신 옵션</li>
                                    <li>우선 입찰권</li>
                                </ul>
                                <button class="plan-btn">선택</button>
                            </div>
                            <div class="pricing-card">
                                <h3>스폰서 배너</h3>
                                <div class="price">$200.00</div>
                                <p class="duration">30일</p>
                                <ul>
                                    <li>프리미엄 배치</li>
                                    <li>추가 노출 보장</li>
                                    <li>브랜딩 강화</li>
                                </ul>
                                <button class="plan-btn">선택</button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="statistics-tab" class="tab-content">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <h4>총 낙찰 금액</h4>
                                <div id="total-revenue-stat" class="stat-value">$0.00</div>
                            </div>
                            <div class="stat-card">
                                <h4>진행 중 옥션</h4>
                                <div id="active-auctions-stat" class="stat-value">0</div>
                            </div>
                            <div class="stat-card">
                                <h4>커뮤니티 상금</h4>
                                <div id="community-reward-stat" class="stat-value">$0.00</div>
                            </div>
                            <div class="stat-card">
                                <h4>P2W 완화율</h4>
                                <div id="p2w-mitigation-stat" class="stat-value">10%</div>
                            </div>
                        </div>
                        <div class="chart-container">
                            <h4>지역별 낙찰가 히스토그램</h4>
                            <canvas id="bid-histogram-chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h4>클릭/노출 데이터</h4>
                            <canvas id="click-exposure-chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h4>P2W 완화 지표</h4>
                            <canvas id="p2w-mitigation-chart"></canvas>
                        </div>
                    </div>
                    
                    <div id="fees-tab" class="tab-content">
                        <div class="fees-info">
                            <h3>수수료 정책</h3>
                            <div class="fee-item">
                                <strong>플랫폼 수수료:</strong>
                                <span>5% (옥션 낙찰가의 5%)</span>
                            </div>
                            <div class="fee-item">
                                <strong>크리에이터 리워드:</strong>
                                <span>10% (커뮤니티 상금 풀로 적립)</span>
                            </div>
                            <div class="fee-item">
                                <strong>P2W 완화 기여:</strong>
                                <span>10% (무료 픽셀 풀로 전환)</span>
                            </div>
                            <div class="fee-breakdown">
                                <h4>수수료 구조 예시 ($100 낙찰 시)</h4>
                                <ul>
                                    <li>플랫폼 수수료: $5.00 (5%)</li>
                                    <li>커뮤니티 상금: $10.00 (10%)</li>
                                    <li>무료 픽셀 풀: $10.00 (10%)</li>
                                    <li>판매자 수익: $75.00 (75%)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 모바일 전환 버튼 (세로 화면에서만 표시) -->
        <div id="mobile-view-toggle" class="mobile-view-toggle hidden">
            <button id="mobile-map-view-btn" class="mobile-toggle-btn active">
                <span>🗺️</span>
                <span>지도</span>
            </button>
            <button id="mobile-list-view-btn" class="mobile-toggle-btn">
                <span>📋</span>
                <span>리스트</span>
            </button>
        </div>
        
        <!-- 모바일 리스트 뷰 -->
        <div id="mobile-list-view" class="mobile-list-view">
            <div class="mobile-list-header">
                <h2>옥션 리스트</h2>
                <button id="mobile-list-close" class="mobile-list-close">&times;</button>
            </div>
            <div class="mobile-list-content">
                <div id="mobile-auction-list" class="auction-list">
                    <p style="text-align: center; color: #666; padding: 20px;">로딩 중...</p>
                </div>
            </div>
        </div>
        
        <!-- 로딩 인디케이터 -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>지도를 불러오는 중...</p>
        </div>
        
        <!-- 신고 모달 -->
        <div id="report-modal" class="modal hidden">
            <div class="modal-content report-modal">
                <div class="modal-header">
                    <h2>
                        <span class="label-primary">픽셀 아트 신고</span>
                        <span class="label-secondary">Report Pixel Art</span>
                    </h2>
                    <button id="close-report-modal" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="report-form">
                        <div class="form-group">
                            <label>
                                <span class="label-primary">신고 사유</span>
                                <span class="label-secondary">Reason</span>
                            </label>
                            <select id="report-reason" class="report-select">
                                <option value="inappropriate">부적절한 내용</option>
                                <option value="spam">스팸/광고</option>
                                <option value="copyright">저작권 침해</option>
                                <option value="harassment">괴롭힘/혐오 표현</option>
                                <option value="other">기타</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>
                                <span class="label-primary">상세 설명</span>
                                <span class="label-secondary">Details</span>
                            </label>
                            <textarea id="report-details" rows="4" placeholder="신고 사유를 자세히 설명해주세요."></textarea>
                        </div>
                        <button id="submit-report-btn" class="report-submit-btn">신고 제출</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 모더레이션 패널 (관리자/모더레이터용) -->
        <div id="moderation-panel" class="moderation-panel hidden">
            <div class="panel-header">
                <h3>
                    <span class="label-primary">모더레이션 패널</span>
                    <span class="label-secondary">Moderation Panel</span>
                </h3>
                <button id="close-moderation-panel" class="close-btn">&times;</button>
            </div>
            <div class="panel-content">
                <div class="moderation-tabs">
                    <button class="tab-btn active" data-tab="pending">대기 중</button>
                    <button class="tab-btn" data-tab="approved">승인됨</button>
                    <button class="tab-btn" data-tab="rejected">거부됨</button>
                </div>
                <div id="moderation-list" class="moderation-list">
                    <p style="text-align: center; color: #666; padding: 20px;">로딩 중...</p>
                </div>
            </div>
        </div>
        
        <!-- 이벤트 모달 -->
        <div id="events-modal" class="modal hidden">
            <div class="modal-content events-modal">
                <div class="modal-header">
                    <h2>
                        <span class="label-primary">커뮤니티 이벤트</span>
                        <span class="label-secondary">Community Events</span>
                    </h2>
                    <button id="close-events-modal" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="events-list" class="events-list">
                        <p style="text-align: center; color: #666; padding: 20px;">로딩 중...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 월간 리포트 모달 -->
        <div id="monthly-report-modal" class="modal hidden">
            <div class="modal-content monthly-report-modal">
                <div class="modal-header">
                    <h2>
                        <span class="label-primary">월간 운영 리포트</span>
                        <span class="label-secondary">Monthly Report</span>
                    </h2>
                    <button id="close-monthly-report-modal" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="monthly-report-content" class="monthly-report-content">
                        <p style="text-align: center; color: #666; padding: 20px;">로딩 중...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 온보딩 투어 -->
        <div id="onboarding-tour" class="onboarding-tour hidden">
            <div class="tour-overlay"></div>
            <div class="tour-content">
                <div class="tour-header">
                    <h2>🌍 세계지도 광고판에 오신 것을 환영합니다!</h2>
                    <button id="tour-close" class="tour-close-btn">&times;</button>
                </div>
                <div class="tour-body">
                    <div class="tour-step active" data-step="1">
                        <h3>1. 옥션 참여하기</h3>
                        <p>지도에서 지역을 클릭하면 옥션에 참여할 수 있습니다. 초기가 $1.00부터 시작하며, 최소 12시간 동안 진행됩니다.</p>
                        <div class="tour-highlight" id="tour-highlight-1"></div>
                    </div>
                    <div class="tour-step" data-step="2">
                        <h3>2. 입찰하기</h3>
                        <p>옥션 모달에서 입찰 금액을 입력하고 입찰 버튼을 클릭하세요. 마지막 5분 내 입찰 시 자동으로 5분 연장됩니다.</p>
                        <div class="tour-highlight" id="tour-highlight-2"></div>
                    </div>
                    <div class="tour-step" data-step="3">
                        <h3>3. 픽셀 아트 편집하기</h3>
                        <p>옥션에서 낙찰되면 해당 지역의 픽셀 아트를 자유롭게 편집할 수 있습니다. 연필, 지우개, 채우기 도구를 사용해보세요.</p>
                        <div class="tour-highlight" id="tour-highlight-3"></div>
                    </div>
                    <div class="tour-step" data-step="4">
                        <h3>4. 옥션 대시보드</h3>
                        <p>좌측 메뉴에서 옥션 대시보드를 열어 진행 중인 옥션, 예정된 옥션, 종료된 옥션을 확인할 수 있습니다.</p>
                        <div class="tour-highlight" id="tour-highlight-4"></div>
                    </div>
                </div>
                <div class="tour-footer">
                    <button id="tour-prev" class="tour-btn tour-btn-secondary" disabled>이전</button>
                    <button id="tour-skip" class="tour-btn tour-btn-secondary">건너뛰기</button>
                    <button id="tour-next" class="tour-btn tour-btn-primary">다음</button>
                    <button id="tour-finish" class="tour-btn tour-btn-primary hidden">완료</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
    <!-- DOMPurify - XSS 방어 라이브러리 -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js" crossorigin="anonymous"></script>
    <!-- Chart.js - 통계 차트 라이브러리 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" crossorigin="anonymous"></script>
    <!-- PayPal JS SDK (Live Mode) - 실제 결제 가능 -->
    <script src="https://www.paypal.com/sdk/js?client-id=AQirNO21I_osrvoS7tvhGdtpGiv9sQC8k0XCurV-xZJZNY5ZnMn_64uwppCgscPbIfX2m1Nn9Z-TTPVp&currency=USD" data-sdk-integration-source="developer-studio"></script>
    <!-- Firebase SDK -->
    <script type="module">
        // Firebase 설정은 script.js에서 초기화
        // 여기서는 SDK만 로드
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Firebase 설정 객체
        // Firebase 프로젝트 설정 방법:
        // 1. https://console.firebase.google.com/ 에서 프로젝트 생성
        // 2. 프로젝트 설정 > 일반 > 앱 추가 > 웹 앱 선택
        // 3. Firebase SDK 설정에서 아래 값들을 복사하여 붙여넣기
        // 4. 인증 > 로그인 방법 > Google 활성화 필요
        const firebaseConfig = {
            apiKey: "AIzaSyAa0BTlcqX9T1PYaHTiv3CmjmZ6srmdZVY",
            authDomain: "worldad-8be07.firebaseapp.com",
            projectId: "worldad-8be07",
            storageBucket: "worldad-8be07.firebasestorage.app",
            messagingSenderId: "460480155784",
            appId: "1:460480155784:web:68e6cea86cf492b3b64f3d",
            measurementId: "G-L2WYZGZK90"
        };
        
        // Firebase 초기화는 script.js에서 처리
        window.firebaseModules = { initializeApp, getAuth, getFirestore, firebaseConfig };
    </script>
    <!-- 전역 오류 처리 -->
    <script>
        // Firestore ERR_BLOCKED_BY_CLIENT 오류 필터링
        // 이 오류는 브라우저 확장 프로그램(광고 차단기 등)에 의해 발생하며, 애플리케이션 기능에는 영향을 미치지 않습니다.
        const originalConsoleError = console.error;
        console.error = function(...args) {
            const errorMessage = args.join(' ');
            // ERR_BLOCKED_BY_CLIENT 오류는 무시 (Firestore WebChannel 종료 요청 차단)
            if (errorMessage.includes('ERR_BLOCKED_BY_CLIENT') || 
                errorMessage.includes('net::ERR_BLOCKED_BY_CLIENT') ||
                (errorMessage.includes('firestore.googleapis.com') && errorMessage.includes('terminate'))) {
                return; // 오류를 콘솔에 표시하지 않음
            }
            // 다른 오류는 정상적으로 표시
            originalConsoleError.apply(console, args);
        };

        // 네트워크 오류 필터링 (fetch/XHR)
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            return originalFetch.apply(this, args).catch(error => {
                // ERR_BLOCKED_BY_CLIENT 오류는 조용히 무시
                if (error.message && error.message.includes('ERR_BLOCKED_BY_CLIENT')) {
                    return Promise.reject(new Error('Request blocked by browser extension'));
                }
                throw error;
            });
        };

        window.addEventListener('error', (event) => {
            // ERR_BLOCKED_BY_CLIENT 오류는 무시
            if (event.message && (
                event.message.includes('ERR_BLOCKED_BY_CLIENT') ||
                event.message.includes('net::ERR_BLOCKED_BY_CLIENT') ||
                (event.message.includes('firestore.googleapis.com') && event.message.includes('terminate'))
            )) {
                event.preventDefault();
                return;
            }

            console.error('Global error:', event.error, event.filename, event.lineno, event.colno);
            if (event.error && event.error.message && event.error.message.includes('Unexpected reserved word')) {
                console.error('Syntax error detected. Please check the browser console for details.');
                const loadingDiv = document.getElementById('loading');
                if (loadingDiv) {
                    loadingDiv.innerHTML = '<div class="spinner"></div><p>스크립트 구문 오류가 발생했습니다. 브라우저 콘솔을 확인해주세요.</p>';
                }
            }
        }, true);

        // unhandledrejection 이벤트도 필터링
        window.addEventListener('unhandledrejection', (event) => {
            const reason = event.reason?.message || event.reason?.toString() || '';
            if (reason.includes('ERR_BLOCKED_BY_CLIENT') || 
                reason.includes('net::ERR_BLOCKED_BY_CLIENT') ||
                (reason.includes('firestore.googleapis.com') && reason.includes('terminate'))) {
                event.preventDefault();
                return;
            }
        });
    </script>
    <!-- 유틸리티 스크립트는 script.js에서 import로 로드됨 -->
    <script type="module" src="script.js"></script>
</body>
</html>
